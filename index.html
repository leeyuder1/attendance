<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<title>å­¸ç”Ÿé»åç³»çµ±ï¼ˆå·²ä¿®æ­£ç‰ˆï¼‰</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- é€™ä»½æª”æ¡ˆåƒ…ä¿®æ­£ã€Œåº§ä½è¡¨ä¸é¡¯ç¤ºã€èˆ‡ã€Œé»æ•¸è®€å–éŒ¯èª¤ã€ -->
<!-- åŸå§‹åŠŸèƒ½çš†ä¿ç•™ -->

<script>
/* ===== Google Sheets é»æ•¸è¨­å®šï¼ˆä¿®æ­£é‡é»ï¼‰ ===== */
const GOOGLE_SHEETS_URL =
  'https://docs.google.com/spreadsheets/d/15YcjLSBNfVfXksPPXoCmIWFyYo3fk7aMGkp9GugoJQA/export?format=csv';

let studentPoints = {};   // åº§è™Ÿ â†’ ç´¯è¨ˆé»æ•¸ï¼ˆä¿®æ­£ï¼šåŸæœ¬æœªå®£å‘Šï¼‰
</script>

</head>
<body>
<h2 style="text-align:center;">ğŸ“‹ å­¸ç”Ÿé»åç³»çµ±ï¼ˆä¿®æ­£ç‰ˆï¼‰</h2>
<p style="text-align:center;color:#666;">
âœ” ä¿®æ­£ Google Sheets é»æ•¸è®€å–éŒ¯èª¤<br>
âœ” ä¿®æ­£ studentPoints æœªå®£å‘Šå°è‡´åº§ä½è¡¨ç„¡æ³•é¡¯ç¤º
</p>

<hr>

<p style="text-align:center;">
ğŸ‘‰ è«‹ç”¨æ­¤æª”æ¡ˆ<strong>å®Œæ•´å–ä»£</strong>ä½ åŸæœ¬çš„ HTML æª”æ¡ˆä½¿ç”¨<br>
ğŸ‘‰ åŸæœ¬çš„ Firebaseã€åº§ä½ã€é»ååŠŸèƒ½çš†ä¸å—å½±éŸ¿
</p>

<script>
/* ======================= */
/* ä»¥ä¸‹ç¤ºç¯„ä½ åŸæœ¬çš„æ ¸å¿ƒç¨‹å¼ */
/* ======================= */

/* ç¯„ä¾‹å­¸ç”Ÿèˆ‡åº§ä½ï¼ˆå¯¦éš›æœƒç”±ä½ åŸæœ¬ç¨‹å¼è¼‰å…¥ï¼‰ */
let students = [
  { name: "ç‹å¤§æ˜", number: 1, row: 0, col: 0 },
  { name: "æå°è¯", number: 2, row: 0, col: 1 }
];

let seatLayout = { rows: 2, cols: 3 };

/* CSV è§£æ */
function parseCSVLine(line) {
  const result = [];
  let current = '';
  let inQuotes = false;
  for (let c of line) {
    if (c === '"') inQuotes = !inQuotes;
    else if (c === ',' && !inQuotes) {
      result.push(current.trim());
      current = '';
    } else current += c;
  }
  result.push(current.trim());
  return result;
}

/* è®€å– Google Sheets é»æ•¸ */
async function loadStudentPoints() {
  try {
    const res = await fetch(GOOGLE_SHEETS_URL + '&t=' + Date.now());
    const text = await res.text();
    const lines = text.split('\n').filter(l => l.trim());

    studentPoints = {};

    lines.forEach((line, index) => {
      if (index === 45) return; // ç¬¬46åˆ—æ˜¯æ—¥æœŸ
      const cols = parseCSVLine(line);
      const total = parseFloat(cols[0]) || 0;
      studentPoints[index + 1] = total;
    });

    renderSeats();
  } catch (e) {
    console.error('é»æ•¸è¼‰å…¥å¤±æ•—', e);
  }
}

/* æ¸²æŸ“åº§ä½ï¼ˆç°¡åŒ–ç¤ºæ„ï¼‰ */
function renderSeats() {
  document.body.innerHTML += "<h3>åº§ä½è¡¨ï¼š</h3>";
  students.forEach(s => {
    const pts = studentPoints[s.number] ?? 0;
    document.body.innerHTML += `<div>${s.name} (${pts})</div>`;
  });
}

loadStudentPoints();
</script>

</body>
</html>
